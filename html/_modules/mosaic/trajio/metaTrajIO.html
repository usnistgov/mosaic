<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>mosaic.trajio.metaTrajIO &#8212; MOSAIC v2.1 documentation</title>
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/bootstrap-sphinx.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/graphviz.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/style.css" />
    <script id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
    <script src="../../../_static/jquery.js"></script>
    <script src="../../../_static/underscore.js"></script>
    <script src="../../../_static/doctools.js"></script>
    <link rel="shortcut icon" href="../../../_static/favicon.ico"/>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />

<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">
<script type="text/javascript" src="../../../_static/js/jquery-1.11.0.min.js "></script>
<script type="text/javascript" src="../../../_static/js/jquery-fix.js "></script>
<script type="text/javascript" src="../../../_static/bootstrap-3.3.7/js/bootstrap.min.js "></script>
<script type="text/javascript" src="../../../_static/bootstrap-sphinx.js "></script>

	<script async type="text/javascript" id="_fed_an_ua_tag" src="https://dap.digitalgov.gov/Universal-Federated-Analytics-Min.js?agency=DOC&subagency=NIST&pua=UA-66610693-1&yt=true&exts=ppsx,pps,f90,sch,rtf,wrl,txz,m1v,xlsm,msi,xsd,f,tif,eps,mpg,xml,pl,xlt,c"></script>	

	<meta name="theme-color" content="#283593">

  </head><body>

  <div id="navbar" class="navbar navbar-default navbar-fixed-top">
    <div class="container">
      <div class="navbar-header">
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="../../../index.html"><span><img src="../../../_static/icon_48.png"></span>
           </a>
        <span class="navbar-text navbar-version pull-left"><b>v2.1</b></span>
      </div>

        <div class="collapse navbar-collapse nav-collapse">
          <ul class="nav navbar-nav">
            
                <li><a href="../../../../latex/MOSAIC.pdf">Download PDF</a></li>
                <li><a href="../../../doc/mailingList.html">Mailing List</a></li>
                <li><a href="//github.com/usnistgov/mosaic">Develop</a></li>
                <li><a href="//github.com/usnistgov/mosaic/issues">Issue Tracker</a></li>
            
            
              <li class="dropdown globaltoc-container">
  <a role="button"
     id="dLabelGlobalToc"
     data-toggle="dropdown"
     data-target="#"
     href="../../../index.html">Contents <b class="caret"></b></a>
  <ul class="dropdown-menu globaltoc"
      role="menu"
      aria-labelledby="dLabelGlobalToc"><ul>
<li class="toctree-l1"><a class="reference internal" href="../../../doc/Introduction.html">1. Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../doc/Algorithms.html">2. Data Processing Algorithms in <em>MOSAIC</em></a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../doc/GettingStarted.html">3. Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../doc/GraphicalInterface.html">4. <em>MOSAIC</em> GUI</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../doc/WebInterface.html">5. <em>MOSAIC</em> WEB</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../doc/settingsFile.html">6. Settings File</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../doc/DatabaseStructure.html">7. Database Structure and Query Syntax</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../doc/ScriptingandAdvancedFeatures.html">8. Scripting and Advanced Features</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../doc/Extend.html">9. Extend <em>MOSAIC</em></a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../doc/PublicationFigures.html">10. Publication Quality Figures</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../doc/AdvancedAnalysis.html">11. Advanced Analysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../doc/Addons.html">12. Addons</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../doc/DeveloperTools.html">13. Developer Tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../doc/apidocs.html">14. API Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../doc/References.html">15. Bibliography</a></li>
</ul>
</ul>
</li>
              
            
            
            
            
            
              <li class="hidden-sm"></li>
            
          </ul>

          
            
<form class="navbar-form navbar-right" action="../../../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
          
        </div>
    </div>
  </div>

<div class="container">
  <div class="row">
    <div class="body col-md-12 content" role="main">
      
  <h1>Source code for mosaic.trajio.metaTrajIO</h1><div class="highlight"><pre>
<span></span><span class="c1"># -*- coding: utf-8 -*-</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">	Read binary ionic current data into numpy arrays</span>

<span class="sd">	:Created:	7/17/2012</span>
<span class="sd"> 	:Author: 	Arvind Balijepalli &lt;arvind.balijepalli@nist.gov&gt;</span>
<span class="sd">	:License:	See LICENSE.TXT	</span>
<span class="sd">	:ChangeLog:</span>
<span class="sd">	.. line-block::</span>
<span class="sd">		4/13/17 	AB 	Negative end values enable runnning an analysis on all available data.</span>
<span class="sd">		7/29/16 	AB 	Add additional filtering when constructing a list of data files to process.</span>
<span class="sd">		1/27/17 	AB 	Perform a lexical sort of input data files</span>
<span class="sd">		9/13/15 	AB 	Updated logging to use mosaicLog class</span>
<span class="sd">		4/4/15		AB 	Merge changes from devel-1.0 	</span>
<span class="sd">		4/1/15 		AB 	Added a new property (DataLengthSec) to estimate the length of a data set.</span>
<span class="sd">		3/28/15 	AB 	Optimized file read interface for improved large file support.</span>
<span class="sd">		1/17/15 	AB 	Store names of processed files in an array.</span>
<span class="sd">		8/22/14 	AB 	Setup a new property (&#39;LastDataFile&#39;) that tracks the current</span>
<span class="sd">						data file being processed.</span>
<span class="sd">		5/27/14		AB 	Added dcOffset kwarg to initialization to allow </span>
<span class="sd">						for offset correction in the ionic current data.</span>
<span class="sd">		2/13/14		AB 	Fixed a potential infinite recursion bug in the</span>
<span class="sd">						initialization. </span>
<span class="sd">		7/17/12		AB	Initial version</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">from</span> <span class="nn">abc</span> <span class="kn">import</span> <span class="n">ABCMeta</span><span class="p">,</span> <span class="n">abstractmethod</span>
<span class="kn">import</span> <span class="nn">glob</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="kn">import</span> <span class="nn">mosaic.settings</span> <span class="k">as</span> <span class="nn">settings</span>
<span class="kn">from</span> <span class="nn">mosaic.utilities.resource_path</span> <span class="kn">import</span> <span class="n">format_path</span><span class="p">,</span> <span class="n">path_separator</span>
<span class="kn">import</span> <span class="nn">mosaic.utilities.mosaicLogging</span> <span class="k">as</span> <span class="nn">mlog</span>
<span class="kn">from</span> <span class="nn">mosaic.utilities.mosaicLogFormat</span> <span class="kn">import</span> <span class="n">_dprop</span><span class="p">,</span> <span class="n">mosaic_property</span>
<span class="kn">import</span> <span class="nn">mosaic.utilities.mosaicTiming</span> <span class="k">as</span> <span class="nn">mtime</span>

<span class="n">__all__</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;metaTrajIO&quot;</span><span class="p">,</span> <span class="s2">&quot;IncompatibleArgumentsError&quot;</span><span class="p">,</span> <span class="s2">&quot;IncorrectDataFormat&quot;</span><span class="p">,</span> <span class="s2">&quot;EndOfFileError&quot;</span><span class="p">,</span> <span class="s2">&quot;SamplingRateChangedError&quot;</span><span class="p">,</span> <span class="s2">&quot;EmptyDataPipeError&quot;</span><span class="p">,</span> <span class="s2">&quot;FileNotFoundError&quot;</span><span class="p">]</span>

<span class="c1"># define custom exceptions</span>
<span class="k">class</span> <span class="nc">IncompatibleArgumentsError</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
	<span class="k">pass</span>
<span class="k">class</span> <span class="nc">InsufficientArgumentsError</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
	<span class="k">pass</span>
<span class="k">class</span> <span class="nc">IncorrectDataFormat</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
	<span class="k">pass</span>
<span class="k">class</span> <span class="nc">EndOfFileError</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
	<span class="k">pass</span>
<span class="k">class</span> <span class="nc">SamplingRateChangedError</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
	<span class="k">pass</span>
<span class="k">class</span> <span class="nc">EmptyDataPipeError</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
	<span class="k">pass</span>
<span class="k">class</span> <span class="nc">FileNotFoundError</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
	<span class="k">pass</span>

<span class="n">trajTimer</span><span class="o">=</span><span class="n">mtime</span><span class="o">.</span><span class="n">mosaicTiming</span><span class="p">()</span>

<span class="n">ignorelist</span><span class="o">=</span><span class="p">[</span>
		<span class="s2">&quot;eventProcessing*.log&quot;</span><span class="p">,</span> 
		<span class="s2">&quot;*.sqlite&quot;</span>
	<span class="p">]</span>

<div class="viewcode-block" id="metaTrajIO"><a class="viewcode-back" href="../../../doc/settingsFile.html#mosaic.trajio.metaTrajIO.metaTrajIO">[docs]</a><span class="k">class</span> <span class="nc">metaTrajIO</span><span class="p">(</span><span class="nb">object</span><span class="p">,</span> <span class="n">metaclass</span><span class="o">=</span><span class="n">ABCMeta</span><span class="p">):</span>
	<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">			.. warning:: |metaclass|</span>

<span class="sd">			Initialize a TrajIO object. The object can load all the data in a directory,</span>
<span class="sd">			N files from a directory or from an explicit list of filenames. In addition </span>
<span class="sd">			to the arguments defined below, implementations of this meta class may require </span>
<span class="sd">			the definition of additional arguments. See the documentation of those classes</span>
<span class="sd">			for what those may be. For example, the qdfTrajIO implementation of metaTrajIO also requires</span>
<span class="sd">			the feedback resistance (Rfb) and feedback capacitance (Cfb) to be passed at initialization.</span>

<span class="sd">			:Parameters:</span>

<span class="sd">				- `dirname` :		all files from a directory (&#39;&lt;full path to data directory&gt;&#39;)</span>
<span class="sd">				- `nfiles` :		if requesting N files (in addition to dirname) from a specified directory</span>
<span class="sd">				- `fnames` : 		explicit list of filenames ([file1, file2,...]). This argument cannot be used in conjuction with dirname/nfiles. The filter argument is ignored when used in combination with fnames. </span>
<span class="sd">				- `filter` :		&#39;&lt;wildcard filter&gt;&#39; (optional, filter is &#39;*&#39; if not specified)</span>
<span class="sd">				- `start` : 		Data start point in seconds.</span>
<span class="sd">				- `end` : 			Data end point in seconds.</span>
<span class="sd">				- `datafilter` :	Handle to the algorithm to use to filter the data. If no algorithm is specified, datafilter	is None and no filtering is performed.</span>
<span class="sd">				- `dcOffset` :		Subtract a DC offset from the ionic current data.</span>
<span class="sd">		</span>

<span class="sd">			:Properties:</span>

<span class="sd">				- `FsHz` :					sampling frequency in Hz. If the data was decimated, this property will hold the sampling frequency after decimation.</span>
<span class="sd">				- `LastFileProcessed` :		return the data file that was last processed.</span>
<span class="sd">				- `ElapsedTimeSeconds` : 	return the analysis time in sec.</span>
<span class="sd">			</span>

<span class="sd">			:Errors:</span>

<span class="sd">				- `IncompatibleArgumentsError` : 	when conflicting arguments are used.</span>
<span class="sd">				- `EmptyDataPipeError` : 			when out of data.</span>
<span class="sd">				- `FileNotFoundError` : 			when data files do not exist in the specified path.</span>
<span class="sd">				- `InsufficientArgumentsError` : 	when incompatible arguments are passed</span>
<span class="sd">	&quot;&quot;&quot;</span>

	<span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">CHUNKSIZE</span><span class="o">=</span><span class="mi">10000</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">dataGenerator</span><span class="o">=</span><span class="kc">None</span>

		<span class="c1"># start by setting all passed keyword arguments as class attributes</span>
		<span class="k">for</span> <span class="p">(</span><span class="n">k</span><span class="p">,</span><span class="n">v</span><span class="p">)</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
			<span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>

		<span class="c1"># Check if the passed arguments are sane	</span>
		<span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;dirname&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;fnames&#39;</span><span class="p">):</span>
			<span class="k">raise</span> <span class="n">IncompatibleArgumentsError</span><span class="p">(</span><span class="s2">&quot;Incompatible arguments: expect either &#39;dirname&#39; or &#39;fnames&#39; when initializing class </span><span class="si">{0}</span><span class="s2">.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="p">))</span>

		<span class="c1"># Check for the filter arg</span>
		<span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;filter&#39;</span><span class="p">):</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">filter</span><span class="o">=</span><span class="s1">&#39;*&#39;</span>

		<span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;fnames&#39;</span><span class="p">):</span>
			<span class="c1"># set fnames here.</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">dataFiles</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">fnames</span>
			<span class="nb">delattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;fnames&#39;</span><span class="p">)</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="k">try</span><span class="p">:</span>
				<span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;dirname&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="s1">&#39;nfiles&#39;</span><span class="p">):</span>
					<span class="c1"># N files from a directory</span>
					<span class="bp">self</span><span class="o">.</span><span class="n">dataFiles</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_buildFileList</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dirname</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">filter</span><span class="p">)[:</span><span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nfiles</span><span class="p">)]</span>
					<span class="nb">delattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;dirname&#39;</span><span class="p">)</span>
					<span class="nb">delattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;nfiles&#39;</span><span class="p">)</span>
				<span class="k">elif</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;dirname&#39;</span><span class="p">):</span>
					<span class="c1"># all files from a directory</span>
					<span class="bp">self</span><span class="o">.</span><span class="n">dataFiles</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_buildFileList</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dirname</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">filter</span><span class="p">)</span>
					<span class="nb">delattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;dirname&#39;</span><span class="p">)</span>
				<span class="k">else</span><span class="p">:</span>
					<span class="k">raise</span> <span class="n">IncompatibleArgumentsError</span><span class="p">(</span><span class="s2">&quot;Missing arguments: &#39;dirname&#39; or &#39;fnames&#39; must be supplied to initialize </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="p">))</span>
			<span class="k">except</span> <span class="ne">AttributeError</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
				<span class="k">raise</span> <span class="n">IncompatibleArgumentsError</span><span class="p">(</span><span class="n">err</span><span class="p">)</span>

		<span class="c1"># set additional meta-data</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">nFiles</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dataFiles</span><span class="p">)</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">fileFormat</span><span class="o">=</span><span class="s1">&#39;N/A&#39;</span>
		<span class="k">try</span><span class="p">:</span>
			<span class="n">sep</span><span class="o">=</span><span class="n">path_separator</span><span class="p">()</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">datPath</span><span class="o">=</span><span class="n">format_path</span><span class="p">(</span><span class="n">sep</span><span class="o">.</span><span class="n">join</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">dataFiles</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span> <span class="n">sep</span> <span class="p">))[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]))</span>
		<span class="k">except</span> <span class="ne">IndexError</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
			<span class="k">raise</span> <span class="ne">FileNotFoundError</span><span class="p">(</span><span class="s2">&quot;Files not found.&quot;</span><span class="p">)</span>

		<span class="c1"># setup data filtering</span>
		<span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;datafilter&#39;</span><span class="p">):</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">dataFilter</span><span class="o">=</span><span class="kc">True</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">dataFilterObj</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_setupDataFilter</span><span class="p">()</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">dataFilter</span><span class="o">=</span><span class="kc">False</span>

		<span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;dcOffset&#39;</span><span class="p">):</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">dcOffset</span><span class="o">=</span><span class="mf">0.0</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">dcOffset</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dcOffset</span><span class="p">)</span>

		<span class="c1"># set start to 0 if it doesn&#39;t exist</span>
		<span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;start&#39;</span><span class="p">):</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">start</span><span class="o">=</span><span class="mf">0.</span>

		<span class="c1"># Track current filename</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">currentFilename</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dataFiles</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

		<span class="c1"># initialize an empty data pipeline</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">currDataPipe</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([])</span>
		<span class="c1"># Track the start point of the queue. This var is used to manage</span>
		<span class="c1"># deletion more effectively, by not deleting elements every time </span>
		<span class="c1"># popdata is called. Instead, data is actually deleted when the index</span>
		<span class="c1"># exceeds 1 million data points.</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">currDataIdx</span><span class="o">=</span><span class="mi">0</span>

		<span class="c1"># a var that determines if the end of the data stream is imminent.</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">nearEndOfData</span><span class="o">=</span><span class="mi">0</span>

		<span class="c1"># A global index that tracks the number of data points retrieved.</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">globalDataIndex</span><span class="o">=</span><span class="mi">0</span>

		<span class="bp">self</span><span class="o">.</span><span class="n">datLenSec</span><span class="o">=</span><span class="mi">0</span>

		<span class="bp">self</span><span class="o">.</span><span class="n">initPipe</span><span class="o">=</span><span class="kc">False</span>

		<span class="c1"># A list that holds the names of processed files.</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">processedFilenames</span><span class="o">=</span><span class="p">[]</span>

		<span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">=</span><span class="n">mlog</span><span class="o">.</span><span class="n">mosaicLogging</span><span class="p">()</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="vm">__name__</span><span class="p">)</span>

		<span class="c1"># Call sub-class init</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">_init</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

	<span class="k">def</span> <span class="nf">Stop</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="n">trajTimer</span><span class="o">.</span><span class="n">PrintStatistics</span><span class="p">()</span>
		<span class="k">raise</span> <span class="n">EmptyDataPipeError</span><span class="p">(</span><span class="s2">&quot;End of data.&quot;</span><span class="p">)</span>

	<span class="c1">#################################################################</span>
	<span class="c1"># Public API: functions</span>
	<span class="c1">#################################################################</span>
	<span class="nd">@property</span>
	<span class="k">def</span> <span class="nf">FsHz</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">			.. important:: |property|</span>

<span class="sd">			Return the sampling frequency in Hz.</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">initPipe</span><span class="p">:</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">_initPipe</span><span class="p">()</span>

		<span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataFilter</span><span class="p">:</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">_dprop</span><span class="p">(</span><span class="s2">&quot;Sampling frequency </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Fs</span><span class="p">))</span>
			<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">Fs</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">_dprop</span><span class="p">(</span><span class="s2">&quot;Sampling frequency </span><span class="si">{0}</span><span class="s2"> (</span><span class="si">{1}</span><span class="s2">)&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataFilterObj</span><span class="o">.</span><span class="n">filterFs</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dataFilterObj</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="p">))</span>
			<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataFilterObj</span><span class="o">.</span><span class="n">filterFs</span>

	<span class="nd">@mosaic_property</span>
	<span class="k">def</span> <span class="nf">ElapsedTimeSeconds</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">			.. important:: |property|</span>

<span class="sd">			Return the elapsed time in the time-series in seconds.</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">initPipe</span><span class="p">:</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">_initPipe</span><span class="p">()</span>

		<span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataFilter</span><span class="p">:</span>
			<span class="n">Fs</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">Fs</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="n">Fs</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dataFilterObj</span><span class="o">.</span><span class="n">filterFs</span>

		<span class="n">elapsedTime</span><span class="o">=</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">globalDataIndex</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">startIndex</span><span class="p">)</span><span class="o">/</span><span class="nb">float</span><span class="p">(</span><span class="n">Fs</span><span class="p">)</span> 

		<span class="k">return</span> <span class="n">elapsedTime</span>

	<span class="nd">@mosaic_property</span> 
	<span class="k">def</span> <span class="nf">LastFileProcessed</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">			.. important:: |property|</span>
<span class="sd">			</span>
<span class="sd">			Return the last data file that was processed</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">currentFilename</span>

	<span class="nd">@mosaic_property</span> 
	<span class="k">def</span> <span class="nf">ProcessedFiles</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">			.. important:: |property|</span>

<span class="sd">			Return a list of processed data filenames.</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">processedFilenames</span>

	<span class="nd">@mosaic_property</span> 
	<span class="k">def</span> <span class="nf">DataLengthSec</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">			.. important:: |property|</span>

<span class="sd">			Return the approximate length of data that will be processed. If the data are in multiple files,</span>
<span class="sd">			this property assumes that each file contains an equal amount of data.</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">initPipe</span><span class="p">:</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">_initPipe</span><span class="p">()</span>

		<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">datLenSec</span>

	<span class="nd">@trajTimer</span><span class="o">.</span><span class="n">FunctionTiming</span>
	<span class="k">def</span> <span class="nf">popdata</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">			Pop data points from self.currDataPipe. This function uses recursion </span>
<span class="sd">			to automatically read data files when the queue length is shorter</span>
<span class="sd">			than the requested data points. When all data files are read, an</span>
<span class="sd">			EmptyDataPipeError is thrown.</span>

<span class="sd">			:Parameters:</span>

<span class="sd">				- `n` : number of requested data points</span>
<span class="sd">			</span>
<span class="sd">			:Returns:</span>
<span class="sd">			</span>
<span class="sd">				- Numpy array with requested data</span>

<span class="sd">			:Errors:</span>
<span class="sd">				</span>
<span class="sd">				- `EmptyDataPipeError` : if the queue has fewer data points than requested.</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">initPipe</span><span class="p">:</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">_initPipe</span><span class="p">()</span>

		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">nearEndOfData</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">:</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">Stop</span><span class="p">()</span>

		<span class="c1"># If the global index exceeds the specied end point, raise an EmptyDataPipError</span>
		<span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;end&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">end</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
			<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">globalDataIndex</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">endIndex</span><span class="p">:</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">Stop</span><span class="p">()</span>

		<span class="k">try</span><span class="p">:</span>
			<span class="c1"># Get the elements to return: index to (index+n)</span>
			<span class="n">t</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">currDataPipe</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">currDataIdx</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">currDataIdx</span><span class="o">+</span><span class="n">n</span><span class="p">]</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">dcOffset</span>
			
			<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">n</span><span class="p">:</span> <span class="k">raise</span> <span class="ne">IndexError</span>

			<span class="c1"># If the required data points were obtained, update the queue and global indices</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">currDataIdx</span><span class="o">+=</span><span class="n">n</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">globalDataIndex</span><span class="o">+=</span><span class="n">n</span>
			
			<span class="c1"># delete them from the pipe if the index exceeds 1 million</span>
			<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">currDataIdx</span><span class="o">&gt;</span><span class="mi">1000000</span><span class="p">:</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">currDataPipe</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">currDataPipe</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">s_</span><span class="p">[:</span><span class="bp">self</span><span class="o">.</span><span class="n">currDataIdx</span><span class="p">:],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
				<span class="c1"># reset the index</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">currDataIdx</span><span class="o">=</span><span class="mi">0</span>

			<span class="c1"># return the popped data</span>
			<span class="k">return</span> <span class="n">t</span>
		<span class="k">except</span> <span class="ne">IndexError</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
			<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">nearEndOfData</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">currDataIdx</span><span class="o">+=</span><span class="n">n</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">globalDataIndex</span><span class="o">+=</span><span class="n">n</span>
				
				<span class="bp">self</span><span class="o">.</span><span class="n">nearEndOfData</span><span class="o">+=</span><span class="mi">1</span>

				<span class="k">return</span> <span class="n">t</span>
			<span class="k">else</span><span class="p">:</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">_appenddata</span><span class="p">()</span>
				<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">popdata</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
				
<div class="viewcode-block" id="metaTrajIO.previewdata"><a class="viewcode-back" href="../../../api-doc/mosaic.meta.html#mosaic.trajio.metaTrajIO.metaTrajIO.previewdata">[docs]</a>	<span class="k">def</span> <span class="nf">previewdata</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">			Preview data points in self.currDataPipe. This function is identical in </span>
<span class="sd">			behavior to popdata, except it does not remove data point from the queue.</span>
<span class="sd">			Like popdata, it uses recursion to automatically read data files </span>
<span class="sd">			when the queue length is shorter than the requested data points. When all </span>
<span class="sd">			data files are read, an	EmptyDataPipeError is thrown.</span>

<span class="sd">			:Parameters:</span>

<span class="sd">				`n` : number of requested data points</span>

<span class="sd">			:Returns:</span>

<span class="sd">				- Numpy array with requested data</span>

<span class="sd">			:Errors:</span>

<span class="sd">				- `EmptyDataPipeError` : if the queue has fewer data points than requested.</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">initPipe</span><span class="p">:</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">_initPipe</span><span class="p">()</span>

		<span class="k">try</span><span class="p">:</span>
			<span class="c1"># Get the elements to return</span>
			<span class="n">t</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">currDataPipe</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">currDataIdx</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">currDataIdx</span><span class="o">+</span><span class="n">n</span><span class="p">]</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">dcOffset</span>
			<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">n</span><span class="p">:</span> <span class="k">raise</span> <span class="ne">IndexError</span> 
				
			<span class="k">return</span> <span class="n">t</span>
		<span class="k">except</span> <span class="ne">IndexError</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
			<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">nearEndOfData</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
				<span class="k">return</span> <span class="n">t</span>
			<span class="k">else</span><span class="p">:</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">_appenddata</span><span class="p">()</span>
				<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">previewdata</span><span class="p">(</span><span class="n">n</span><span class="p">)</span></div>


<div class="viewcode-block" id="metaTrajIO.formatsettings"><a class="viewcode-back" href="../../../api-doc/mosaic.meta.html#mosaic.trajio.metaTrajIO.metaTrajIO.formatsettings">[docs]</a>	<span class="k">def</span> <span class="nf">formatsettings</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">			Return a formatted string of settings for display</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span> <span class="s1">&#39;</span><span class="se">\t</span><span class="s1">Trajectory I/O settings:&#39;</span> <span class="p">)</span>
		
		<span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span> <span class="s1">&#39;</span><span class="se">\t\t</span><span class="s1">Files processed = </span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nFiles</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dataFiles</span><span class="p">))</span> <span class="p">)</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span> <span class="s1">&#39;</span><span class="se">\t\t</span><span class="s1">Data path = </span><span class="se">\&#39;</span><span class="si">{0}</span><span class="se">\&#39;</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">datPath</span><span class="p">)</span> <span class="p">)</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span> <span class="s1">&#39;</span><span class="se">\t\t</span><span class="s1">File format = </span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fileFormat</span><span class="p">)</span> <span class="p">)</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span> <span class="s1">&#39;</span><span class="se">\t\t</span><span class="s1">Sampling frequency = </span><span class="si">{0}</span><span class="s1"> kHz&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">FsHz</span><span class="o">*</span><span class="mf">1e-3</span><span class="p">)</span> <span class="p">)</span>

		<span class="c1"># Sub-class formatted settings</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">_formatsettings</span><span class="p">()</span>

		<span class="c1"># add the filter settings</span>
		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataFilter</span><span class="p">:</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">dataFilterObj</span><span class="o">.</span><span class="n">formatsettings</span><span class="p">()</span></div>


	<span class="c1">#################################################################</span>
	<span class="c1"># Private API: Interface functions, implemented by sub-classes.</span>
	<span class="c1"># Should not be called from external classes</span>
	<span class="c1">#################################################################</span>
	<span class="k">def</span> <span class="nf">_appenddata</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">			Read the specified data file(s) and append its data to the data pipeline. Set </span>
<span class="sd">			a class property FsHz with the sampling frequency in Hz.</span>

<span class="sd">			:Parameters:</span>

<span class="sd">				- None</span>
<span class="sd">			</span>
<span class="sd">			.. seealso:: See implementations of metaTrajIO for specfic documentation.</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="k">try</span><span class="p">:</span>			
			<span class="n">data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">scaleData</span><span class="p">(</span><span class="nb">next</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dataGenerator</span><span class="p">))</span>

			<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataFilter</span><span class="p">:</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">dataFilterObj</span><span class="o">.</span><span class="n">filterData</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Fs</span><span class="p">)</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">currDataPipe</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">currDataPipe</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataFilterObj</span><span class="o">.</span><span class="n">filteredData</span> <span class="p">))</span>
			<span class="k">else</span><span class="p">:</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">currDataPipe</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">currDataPipe</span><span class="p">,</span> <span class="n">data</span> <span class="p">))</span>

		<span class="k">except</span> <span class="p">(</span><span class="ne">StopIteration</span><span class="p">,</span> <span class="ne">AttributeError</span><span class="p">,</span> <span class="ne">TypeError</span><span class="p">):</span>
			<span class="c1"># Read a new data file to get more data</span>
			<span class="n">fname</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">popfnames</span><span class="p">()</span>

			<span class="k">if</span> <span class="n">fname</span><span class="p">:</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">processedFilenames</span><span class="o">.</span><span class="n">extend</span><span class="p">([[</span><span class="n">fname</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">fileFormat</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">getmtime</span><span class="p">(</span><span class="n">fname</span><span class="p">)]])</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">rawData</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">readdata</span><span class="p">(</span> <span class="n">fname</span> <span class="p">)</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">dataGenerator</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_createGenerator</span><span class="p">()</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">_appenddata</span><span class="p">()</span>
		
<div class="viewcode-block" id="metaTrajIO.scaleData"><a class="viewcode-back" href="../../../api-doc/mosaic.meta.html#mosaic.trajio.metaTrajIO.metaTrajIO.scaleData">[docs]</a>	<span class="k">def</span> <span class="nf">scaleData</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">			.. important:: |interfacemethod|</span>

<span class="sd">			Scale the raw data loaded with :func:`~mosaic.metaTrajIO.metaTrajIO.readdata`. Note this function will not necessarily receive the entire data array loaded with :func:`~mosaic.metaTrajIO.metaTrajIO.readdata`. Transformations must be able to process partial data chunks.</span>

<span class="sd">			:Parameters:</span>
<span class="sd">			</span>
<span class="sd">				- `data` : partial chunk of raw data loaded using :func:`~mosaic.metaTrajIO.metaTrajIO.readdata`.</span>

<span class="sd">			:Returns:</span>

<span class="sd">				- Array containing scaled data.</span>

<span class="sd">			:Default Behavior:</span>

<span class="sd">				- If not implemented by a sub-class, the default behavior is to return ``data`` to the calling function without modifications.</span>

<span class="sd">			:Example:</span>

<span class="sd">				Assuming the amplifier scale and offset values are stored in the class variables ``AmplifierScale`` and ``AmplifierOffset``, the raw data read using :func:`~mosaic.metaTrajIO.metaTrajIO.readdata` can be transformed by :func:`~mosaic.metaTrajIO.metaTrajIO.scaleData`. We can also use this function to change the array data type.</span>

<span class="sd">			.. code-block:: python</span>

<span class="sd">				def scaleData(self, data):</span>
<span class="sd">					return np.array(data*self.AmplifierScale-self.AmplifierOffset, dtype=&#39;f8&#39;)</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="k">return</span> <span class="n">data</span></div>

<div class="viewcode-block" id="metaTrajIO._formatsettings"><a class="viewcode-back" href="../../../api-doc/mosaic.meta.html#mosaic.trajio.metaTrajIO.metaTrajIO._formatsettings">[docs]</a>	<span class="nd">@abstractmethod</span>
	<span class="k">def</span> <span class="nf">_formatsettings</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">			Log settings strings</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="k">pass</span></div>
		
<div class="viewcode-block" id="metaTrajIO._init"><a class="viewcode-back" href="../../../api-doc/mosaic.meta.html#mosaic.trajio.metaTrajIO.metaTrajIO._init">[docs]</a>	<span class="nd">@abstractmethod</span>
	<span class="k">def</span> <span class="nf">_init</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">			.. important:: |abstractmethod|</span>

<span class="sd">			This function is called at the end of the class constructor to perform additional initialization specific to the algorithm being implemented. The arguments to this function are identical to those passed to the class constructor.</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="k">pass</span></div>

<div class="viewcode-block" id="metaTrajIO.readdata"><a class="viewcode-back" href="../../../api-doc/mosaic.meta.html#mosaic.trajio.metaTrajIO.metaTrajIO.readdata">[docs]</a>	<span class="nd">@abstractmethod</span>
	<span class="k">def</span> <span class="nf">readdata</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fname</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">			.. important:: |abstractmethod|</span>

<span class="sd">			Return raw data from a single data file. Set a class </span>
<span class="sd">			attribute Fs with the sampling frequency in Hz.</span>

<span class="sd">			:Parameters:</span>

<span class="sd">				- `fname` :  fileame to read</span>
<span class="sd">			</span>
<span class="sd">			:Returns:</span>
<span class="sd">			</span>
<span class="sd">				An array object that holds raw (unscaled) data from `fname`</span>
<span class="sd">			</span>
<span class="sd">			:Errors:</span>
<span class="sd">			</span>
<span class="sd">				None</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="k">pass</span></div>

<div class="viewcode-block" id="metaTrajIO.popfnames"><a class="viewcode-back" href="../../../api-doc/mosaic.meta.html#mosaic.trajio.metaTrajIO.metaTrajIO.popfnames">[docs]</a>	<span class="k">def</span> <span class="nf">popfnames</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">			Pop a single filename from the start of ``self.dataFiles``. If ``self.dataFiles`` is empty,</span>
<span class="sd">			raise an ``EmptyDataPipeError`` error. </span>

<span class="sd">			:Parameters:</span>
<span class="sd">			</span>
<span class="sd">				- None</span>
<span class="sd">			</span>
<span class="sd">			:Returns:</span>
<span class="sd">			</span>
<span class="sd">				A single filename if successful.</span>

<span class="sd">			:Errors:</span>

<span class="sd">				- `EmptyDataPipeError` : when the filename list is empty.</span>

<span class="sd">		&quot;&quot;&quot;</span>
		<span class="k">try</span><span class="p">:</span>
			<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataFiles</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
		<span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
			<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">nearEndOfData</span><span class="p">:</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">Stop</span><span class="p">()</span>
			<span class="k">else</span><span class="p">:</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Approaching the end of the data stream.&quot;</span><span class="p">)</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">nearEndOfData</span><span class="o">+=</span><span class="mi">1</span></div>

	<span class="c1">#################################################################</span>
	<span class="c1"># Internal Functions</span>
	<span class="c1">#################################################################</span>
	<span class="k">def</span> <span class="nf">_initPipe</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="c1"># Last, on startup load a single data file to force</span>
		<span class="c1"># the sampling frequency FsHz to be set on startup</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">_appenddata</span><span class="p">()</span>
		
		<span class="bp">self</span><span class="o">.</span><span class="n">initPipe</span><span class="o">=</span><span class="kc">True</span>

		<span class="bp">self</span><span class="o">.</span><span class="n">datLenSec</span><span class="o">=</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rawData</span><span class="p">)</span><span class="o">/</span><span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Fs</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dataFiles</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span>

		<span class="c1"># Set the end point</span>
		<span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;end&#39;</span><span class="p">):</span>
			<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">end</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>			<span class="c1"># treat a negative end value the same as not setting end.</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">endIndex</span><span class="o">=</span><span class="nb">int</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">end</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">Fs</span><span class="p">)</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">datLenSec</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">end</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">start</span>
			
			
		<span class="c1"># Drop the first &#39;n&#39; points specified by the start keyword</span>
		<span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;start&#39;</span><span class="p">):</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">startIndex</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">start</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">Fs</span><span class="p">)</span>
			<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">startIndex</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
				<span class="n">nBlks</span><span class="o">=</span><span class="nb">int</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">startIndex</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">CHUNKSIZE</span><span class="p">)</span>
				<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nBlks</span><span class="p">):</span>
					<span class="bp">self</span><span class="o">.</span><span class="n">popdata</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">CHUNKSIZE</span><span class="p">)</span>

				<span class="bp">self</span><span class="o">.</span><span class="n">popdata</span><span class="p">(</span> <span class="nb">int</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">startIndex</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">%</span><span class="bp">self</span><span class="o">.</span><span class="n">CHUNKSIZE</span><span class="p">)</span> <span class="p">)</span>

	<span class="k">def</span> <span class="nf">_setupDataFilter</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="n">filtsettings</span><span class="o">=</span><span class="n">settings</span><span class="o">.</span><span class="n">settings</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">datPath</span> <span class="p">)</span><span class="o">.</span><span class="n">getSettings</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">datafilter</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
		<span class="k">if</span> <span class="n">filtsettings</span><span class="o">==</span><span class="p">{}:</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;WARNING: No settings found for &#39;</span><span class="si">{0}</span><span class="s2">&#39;. Data filtering is disabled&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">datafilter</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)))</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">dataFilter</span><span class="o">=</span><span class="kc">False</span>
			<span class="k">return</span>

		<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">datafilter</span><span class="p">(</span><span class="o">**</span><span class="n">filtsettings</span><span class="p">)</span>

	<span class="k">def</span> <span class="nf">_createGenerator</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="n">i</span><span class="o">=</span><span class="mi">0</span>
		<span class="k">while</span> <span class="n">i</span><span class="o">&lt;</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rawData</span><span class="p">):</span>
			<span class="k">yield</span> <span class="bp">self</span><span class="o">.</span><span class="n">rawData</span><span class="p">[</span><span class="n">i</span><span class="p">:</span><span class="n">i</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">CHUNKSIZE</span><span class="p">]</span>
			<span class="n">i</span><span class="o">+=</span><span class="bp">self</span><span class="o">.</span><span class="n">CHUNKSIZE</span>

	<span class="k">def</span> <span class="nf">_buildFileList</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dirname</span><span class="p">,</span> <span class="nb">filter</span><span class="p">):</span>
		<span class="n">flist</span><span class="o">=</span><span class="nb">set</span><span class="p">(</span><span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">format_path</span><span class="p">(</span><span class="n">dirname</span><span class="o">+</span><span class="s2">&quot;/&quot;</span><span class="o">+</span><span class="nb">filter</span><span class="p">)))</span>
		<span class="k">for</span> <span class="n">ignorefilter</span> <span class="ow">in</span> <span class="n">ignorelist</span><span class="p">:</span>
			<span class="n">flist</span><span class="o">=</span><span class="n">flist</span><span class="o">-</span><span class="nb">set</span><span class="p">(</span><span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">format_path</span><span class="p">(</span><span class="n">dirname</span><span class="o">+</span><span class="s2">&quot;/&quot;</span><span class="o">+</span><span class="n">ignorefilter</span><span class="p">)))</span>
		<span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="n">flist</span><span class="p">)</span></div>

</pre></div>

    </div>
      
  </div>
</div>
<!-- 
<footer class="footer">
  <div class="container">
    <p class="pull-right">
      <a href="#">Back to top</a>
      
    </p>
    <p>
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 3.5.4.<br/>
    </p>
  </div>
</footer> -->
<script type="text/javascript"
	src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>
<div class="footer" style="vertical-align: center" align="center">
		<table width="90%" style="vertical-align: center">
			<col width=40%>
			<col width=60%>
			<tr>
				<td align="left">
					<a href="../../../doc/Developers.html"><small><em>MOSAIC Developers</em></small></a> |
					<a href="http://www.nist.gov/pml/div683/grp06/abalijepalli.cfm"><small><em>Contact</em></small></a> |
					<a href="../../../doc/Disclaimer.html"><small><em>Terms of Use</em></small></a>
				</td>
			<!-- </tr>
			<tr> -->
				<td align="right">
					<a target="_blank" href="http://www.nist.gov/public_affairs/privacy.cfm#privpolicy"><small>Privacy Policy</small></a> |
					<a target="_blank" href="http://www.nist.gov/public_affairs/privacy.cfm#secnot"><small>Security Notice</small></a> |
					<a href="http://www.nist.gov/public_affairs/privacy.cfm#accesstate"><small>Accessibility Statement</small></a> |
					<a target="_blank" href="mailto:data@nist.gov?subject=Feedback%20on%20Web%20Site%20Template"><small>Send feedback</small></a>
					<br/>
				</td>
			</tr>
		</table>

		<br />
		<a href="http://www.nist.gov/"><small><em>National Institute of Standards and Technology</em></small></a>
		<!-- <a href="http://www.nist.gov"><img src="_static/nist_logo.png" width="30%" alt="National Institute of Standards and Technology"></a> -->

</div>

  </body>
</html>